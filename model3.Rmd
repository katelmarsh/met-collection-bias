# [Model 3]


## random forest

reference: https://www.r-bloggers.com/2021/04/random-forest-in-r/
https://stats.stackexchange.com/questions/493714/random-forest-variable-importance-plot-discrepancy


```{r}
library(caret)
library(randomForest)

table(train_dat[,c('is.highlight', 'is.public.domain')])
#table(train_dat[,c('is.highlight', 'department')])

set.seed(51)

train_dat$is.highlight <- as.factor(train_dat$is.highlight)
test_dat$is.highlight <- as.factor(test_dat$is.highlight)

model <- randomForest(is.highlight~is.public.domain + department + country +
                        region + subregion + county + state + city +
                        classification, 
               data = train_dat, 
               method = 'rf',
               trControl = trainControl(method = 'cv',number = 5), 
               importance = TRUE)

p1 <- predict(model, train_dat)
caret::confusionMatrix(p1, train_dat$is.highlight)

p2 <- predict(model, test_dat)
caret::confusionMatrix(p2, test_dat$is.highlight)

plot(model)

print(paste0("The accuracy on the training dataset is: ",mean(predict(model, train_dat) == train_dat$is.highlight)))
print(paste0("The accuracy on the testing dataset is: ",mean(predict(model, test_dat) == test_dat$is.highlight)))
```



```{r}
#var_imp <- varImpPlot(model,
#           sort = T,
#           n.var = 10,
#           main = "Top 10 - Variable Importance")

var.imp <- as.data.frame(model$importance)
var.imp$feature <- rownames(var.imp) 

g <- ggplot(var.imp, aes(x = feature, y=MeanDecreaseAccuracy)) + 
  theme_bw() + geom_point() + 
  theme(axis.text.x = element_text(angle=-40, hjust=.1)) + coord_flip() +
  ggtitle("Feature Importance By Mean Decrease in Accuracy")

library(plotly)

ggplotly(g)

```

